{% extends "dossiers/base.html" %}
{% load url from future %}

{% block appbar %}
<h2>{{ object.last_name }} {{ object.first_name }} - Dossier {{ object.paper_id|default_if_none:"" }}</h2>
<a href="..">Retourner aux dossiers</a>
<button>Supprimer</button>
{% endblock %}

{% block content %}
<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Général</a></li>
    <li><a href="#tabs-2">Fiche administrative</a></li>
    <li><a href="#tabs-3">Adresses / contacts</a></li>
    <li><a href="#tabs-4">Prise en charge</a></li>
    <!--<li><a href="#tabs-5">Liste des actes</a>-->
    <li><a href="#tabs-6">Prochains rendez-vous</a>
    <li><a href="#tabs-7">Socialisation</a>
    <li><a href="#tabs-8">Données à caractère médical</a>
  </ul>
  <div id="tabs-1"> <!-- Général -->
    <div class="left">
      <ul>
        <li><label>N° dossier papier :</label> {{ object.paper_id|default_if_none:"Aucun" }} <button>✍</button></li>
        <li><label>N° dossier informatique :</label>{{ object.id }}</li>
        <li><label>Nom :</label> {{ object.last_name }}</li>
        <li><label>Prénom :</label> {{ object.first_name }}</li>
        <li><label>Date de naissance :</label> {{ object.birthdate|date:"d/m/Y" }}</li>
        <li><label>Lieux de vie :</label>
        <ul>
          {% for address in object.addresses.all %}
          <li>{{ address.address }}, {{ address.city }} - {{ address.phone }} </li>
          {% endfor %}

        </ul></li>
        <li><label>Date d'inscription :</label> {{ object.created|date:"d/m/Y" }}</li>
        <li><label>Lieu de socialisation :</label> {{ object.school }}</li>
        <li><label>Commentaire :</label><br/>
        <textarea cols="50" rows="5">{{ object.comment|default_if_none:"" }}</textarea>
        <button>Mettre à jour</button></li>
      </ul>
    </div>
    <div class="right">
      <ul>
          <li><label>Dernier acte :</label>
          {% if last_rdv %}
          {{ last_rdv.start_datetime|date:"d/m/Y" }} - 
          {% for participant in last_rdv.participants %}
          {{ participant.last_name }} - 
          {% endfor %}
          {{ last_rdv.act_type }}
          {% endif %}
          </li>
          <li><label>Prochain rendez-vous :</label>
          {% if next_rdv %}
          {{ next_rdv.start_datetime|date:"d/m/Y" }} - 
          {% for participant in next_rdv.participants %}
          {{ participant.next_name }} - 
          {% endfor %}
          {{ next_rdv.act_type }}
          {% endif %}
          </li>
      </ul>
      <div class="etat">
          <h4>État du dossier :  {{ object.last_state.status.name.lower }}</h4>
          <p>depuis le {{ object.last_state.created|date:"d/m/Y" }}</p>
          <p><label>Commentaire :</label>{{ object.last_state.comment }}</p>
        <button id="close-patientrecord">Clore</button>
        <button id="reopen-patientrecord">Ré-accueillir</button>
        <button id="patientrecord-history">Historique</button><br/>
        <hr/>
        3/6 diagnostics
      </div>

      <div class="notifs">
        <h4>Notifications</h4>
        <ul>
          <li>Dossier en pause facturation <button>Sortir</button></li>
        </ul>
      </div>

    </div>
    <br style="clear:both"/>
  </div>

  <div id="tabs-2"> <!-- Fiche administrative -->
    <form method="post" id="services-form">
    {% csrf_token %}
    <div class="frame inline">
      <h3>État civil</h3>
      <button class="save">✔</button>
      <p>
      {{ forms.id.last_name.label_tag }} : {{ forms.id.last_name }}
      {{ forms.id.first_name.label_tag }} : {{ forms.id.first_name }}
      </p>
      <p>
      {{ forms.id.birthdate.label_tag }} : {{ forms.id.birthdate }}
      {{ forms.id.gender.label_tag }} : {{ forms.id.gender }}
      {{ forms.id.nationality.label_tag }} : {{ forms.id.nationality }}
      </p>
      <input type="hidden"  name="tab"  value="1">
    </div>
  </form>


    <form method="post" id="services-form">
    {% csrf_token %}
    <div class="frame inline">
      <h3>Physiologie</h3>
      <button class="save">✔</button>
      <p>
      {% for field in forms.physiology %}
      {{ field.label_tag  }} : {{ field }}
      {% endfor %}
      </p>
      <input type="hidden"  name="tab"  value="1">
    </div>
  </form>

    <div class="frame">
      <h3>Inscription</h3>
      <button class="save">✔</button>
      <p>
      <label>Motif (analysé) :</label> <select><option>Indéfini</option></select> <button>+</button>
      <label>Motif (famille) :</label> <select><option>Indéfini</option></select> <button>+</button>
      <label>Conseilleur :</label> <select><option>Indéfini</option></select> <button>+</button>
      </p>
      <input type="hidden"  name="tab"  value="1">

    </div>

    <div class="frame">
      <h3>Famille</h3>
      <button class="save">✔</button>
      <p><label>Place dans la fratrie :</label> <input size="4"/>
      <label>Nombre d'enfants dans la fratrie :</label> <input size="4"/>
      <label>Rang (gémellité) :</label> <input size="4"/>
      </p>
      <p>
      <label>Autorité parentale :</label> <select><option>Indéfini</option></select> <button>+</button>
      <label>Situation familiale :</label> <select><option>Indéfini</option></select> <button>+</button>
      <label>Garde parentale :</label> <select><option>Indéfini</option></select> <button>+</button>
      </p>
      <input type="hidden"  name="tab"  value="1">

    </div>

    <div class="frame">
      <h3>Transport</h3>
      <button class="save">✔</button>
      <p>
      <label>Type de transport :</label> <select><option>Indéfini</option></select> <button>+</button>
      <label>Compagnie de transport :</label> <select><option>Indéfini</option></select> <button>+</button>
      </p>
      <table>
        <tr><td><button>Attestation</button></td> <td><button>Prescription</td></tr>
          <tr><td>Dernière attestation le 25/07/2012 <button>Historique</button></td>
            <td>Dernière prescription le 25/07/2012 <button>Historique</button></td></tr>
        </table>
      <input type="hidden"  name="tab"  value="1">
      </div>

      <div class="frame">
        <h3>Suivi du patient</h3>
        <button class="save">✔</button>
        <p>
        <label>Coordinateur I :</label> <select><option>Indéfini</option></select> <button>+</button>
        <label>Coordinateur II :</label> <select><option>Indéfini</option></select> <button>+</button>
        <label>Coordinateur III :</label> <select><option>Indéfini</option></select> <button>+</button>
        </p>
        <p>
        <label>Médecin extérieur :</label> <select><option>Indéfini</option></select> <button>+</button>
        <label>Intervenant extérieur :</label> <select><option>Indéfini</option></select> <button>+</button>
        </p>
      <input type="hidden"  name="tab"  value="1">
      </div>

    </div>

    <div id="tabs-3"> <!-- Adresses / Contacts -->
      <button id="new-address-btn">Nouvelle adresse</button> <button>Nouveau contact</button>
      <div class="frame">
        <h3>16 rue du Clocher</h3>
        <div class="buttons"><button>➖</button> <button>✍</button></div>
        <div class="right">
          <input type="checkbox" checked>Lieu de vie</input>
        </div>
        <p>13004 Marseille</p>
        <p>04 91 12 34 56</p>
        <div class="contact">
          <h4>Mme Marie Carmarie</h4>
          <div class="right">
            <input type="radio" name="radio-assure" checked="checked">Assuré</input>
            <button>➖</button> <button>✍</button>
          </div>
          <p>2 70 12 34 567 890 12</p>
          <p>06 12 34 56 78</p>
        </div>
        <div class="contact patient">
          <h4>M. Guillaume Bouclier (PATIENT)</h4>
          <div class="right">
            <input type="radio" name="radio-assure" >Assuré</input>
            <button>➖</button> <button>✍</button>
          </div>
          <p>1 04 12 34 567 890 12</p>
        </div>
      </div>

      <div class="frame">
        <h3>2 rue du Château</h3>
        <div class="buttons"><button>➖</button> <button>✍</button></div>
        <div class="right">
          <input type="checkbox">Lieu de vie</input>
        </div>
        <p>42000 Saint-Etienne</p>
        <p>04 77 12 34 56</p>
        <div class="contact">
          <h4>M. John Leponge</h4>
          <div class="right">
            <input type="radio" name="radio-assure">Assuré</input>
            <button>➖</button> <button>✍</button>
          </div>
          <p>1 70 12 34 567 890 12</p>
        </div>
      </div>

    </div>

    <div id="tabs-4"> <!-- Prise en charge -->
      <div id="patient-diag">
        <div class="frame">
          <h3>En diagnostic depuis le 11 juin 2012</h3>
          <ul>
            <li><input size="4" value="6"/> actes prévus</li>
            <li><strong>3</strong> actes réalisés dont <strong>2</strong> facturés <button class="blind">détails</button>
            <ul>
              <li>Facturation <strong>28</strong> (assuré: Sophie Fonfec) - <strong>2</strong> actes
              <ul>
                <li>Accueil le 11 juin 2012 - 9h00 - 45 minutes - Bob Leponge</li>
                <li>Dialogue le 12 juin 2012 - 10h00 - 30 minutes - Bob Leponge</li>
              </ul></li>
              <li>Non facturé - <strong>1 acte</strong>
              <ul>
                <li>Dialogue le 13 juin 2012 - 11h00 - 45 minutes - Sandy Kilo</li>
              </ul></li>
            </ul>
            </li>
          </ul>
        </div>
      </div>

      <div id="patient-traitement" style="display: none;">
        <div class="frame">
          <h3>En diagnostic depuis le 6 mars 2012</h3>
          <ul>
            <li><strong>6</strong> actes réalisés et facturés <button class="blind">détails</button>
            <ul>
              <li>Facturation <strong>28</strong> (assuré: Sophie Fonfec) - <strong>6</strong> actes
              <ul>
                <li>...</li>
              </ul></li>
            </ul>
            </li>
          </ul>
        </div>

        <div class="frame">
          <h3>En traitement depuis le 11 juin 2012</h3>
          <ul>
            <li><strong>4</strong> actes réalisés <button class="blind">détails</button>
            <ul><li>...</li></ul>
            </li>
            <li>Pas de prise en charge - <button id="add-prise-en-charge-btn">Ajouter une prise en charge</button></li>
          </ul>
        </div>

      </div>

      <div id="patient-traitement-charge" style="display: none;">

        <div class="frame">
          <h3>En diagnostic depuis le 2 avril 2008</h3>
          <ul>
            <li><strong>3</strong> actes réalisés et facturés <button class="blind">détails</button>
            <ul>
              <li>Facturation <strong>28</strong> (assuré: Sophie Fonfec) - <strong>3</strong> actes
              <ul>
                <li>...</li>
              </ul></li>
            </ul>
            </li>
          </ul>
        </div>

        <div class="frame">
          <h3>En diagnostic depuis le 5 octobre 2010</h3>
          <ul>
            <li><strong>6</strong> actes réalisés et facturés <button class="blind">détails</button>
            <ul>
              <li>Facturation <strong>28</strong> (assuré: Sophie Fonfec) - <strong>6</strong> actes
              <ul>
                <li>...</li>
              </ul></li>
            </ul>
            </li>
          </ul>
        </div>

        <div class="frame">
          <h3>En traitement depuis le 12 décembre 2010</h3>
          <ul>
            <li>Prise en charge depuis le 12 décembre 2010
            <ul>
              <li><strong>30</strong> actes réalisés et facturés <button class="blind">détails</button>
              <ul><li>...</li></ul></li>
              <li><strong>10</strong> actes réalisés et facturés en prolongation <button class="blind">détails</button>
              <ul><li>...</li></ul></li>
              <li><strong>6</strong> actes réalisés et non pris en charge <button class="blind">détails</button>
              <ul><li>...</li></ul></li>
            </ul>
            </li>
            <li>Prise en charge depuis le 15 décembre 2011
            <ul>
              <li><strong>30</strong> actes réalisés et facturés <button class="blind">détails</button>
              <ul><li>...</li></ul></li>
              <li><strong>6</strong> actes réalisés non facturés <button class="blind">détails</button>
              <ul><li>...</li></ul></li>
              <li><button id="add-prolongation-btn">Ajouter une prolongation</button></li>
            </ul>
            </li>
          </ul>
        </div>


      </div>

      <div id="overlay">
        <p>
        Exemples pour cet onglet :
        <a href="#" onclick="$('#patient-diag').show(); $('#patient-traitement').hide(); $('#patient-traitement-charge').hide();">Patient en diagnostic</a> -
        <a href="#" onclick="$('#patient-diag').hide(); $('#patient-traitement').show(); $('#patient-traitement-charge').hide();">Patient en traitement</a> -
        <a href="#" onclick="$('#patient-diag').hide(); $('#patient-traitement').hide(); $('#patient-traitement-charge').show();">Patient en traitement avec prise en charge</a>
        </p>
      </div>

    </div>

    <!--
    <div id="tabs-5">
    </div>
    -->

    <div id="tabs-6">
    </div>

    <div id="tabs-7">
    </div>

    <div id="tabs-8">
    </div>
  </div>
</div>
{% endblock %}

{% block dialogs %}
<div id="change-record" style="display: none;" data-id="{{ object.id }}" data-service-id="{{ service_id }}">
 </div>

  <div id="dossier-histo-dlg" style="display: none;">
   <dl>
    {% for state in states %}
    <dt><b>{{ state.created|date:"d/m/Y" }}</b> <small>(date info: {{ state.date_selected|date:"d/m/Y" }})</small></dt>
    <dd>
    <p><b>{{ state.status.name }}</b>; <label>commentaire:</label> {{ state.comment }}</p>
    <p>changement par {{ state.author }}</p>
    </dd>
    {% endfor%}
   </dl>
  </div>

  <div id="new-address-dlg" style="display: none;">
   <form>
   <table>
   <tr>
   <td>
   <label for="id_numero">Numéro :</label><br/>
   <input id="id_numero" class="numero" name="numero" size="10"/>
   </td>
   <td>
   <label for="id_rue">Rue :</label><br/>
   <input id="id_rue" class="rue" name="rue" size="35"/>
   </td>
   </tr>
   <tr>
   <td>
   <label for="id_cp">Code postal :</label><br/>
   <input id="id_cp" class="cp" name="cp" size="10"/>
   </td>
   <td>
   <label for="id_ville">Ville :</label><br/>
   <input id="id_ville" class="ville" name="ville" size="35"/>
   </td>
   </tr>
   </table>
   <p>
   <br/>
   <label for="id_tel">Téléphone :</label>
   <input id="id_tel" class="tel" name="tel" size="35"/>
   <button>+</button>
   <p>
   <input type="checkbox">Lieu de vie</input>
   </p>
   </form>

  </div>

  <div id="add-prise-en-charge-dlg" style="display: none;">
   <div>
    <label for="id_partir">À partir du :</label>
    <input id="id_partir" class="partir" name="partir" size="10" value="11/06/2012"/>
   </div>
   <div>
    <label for="id_pour">Pour :</label>
    <input id="id_pour" class="pour" name="pour" size="4" value="30"/> séances
   </div>
  </div>

  <div id="add-prolongation-dlg" style="display: none;">
   <div>
    <label for="id_pour">Pour :</label>
    <input id="id_pour" class="pour" name="pour" size="4" value="10"/> actes
   </div>
  </div>
{% endblock %}

