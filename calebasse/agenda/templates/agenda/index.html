{% extends "agenda/base.html" %}
{% load url from future %}

{% block appbar %}
    <h2>Agenda</h2>
    <a href="../..">Retourner à l'accueil</a>
    <button class="newevent" data-hour="" data-url="{% url 'new-event' service=service date=date %}">Nouvel événement</button>
    <button class="newrdv" data-hour="" data-url="{% url 'nouveau-rdv' service=service date=date %}">Nouveau rendez-vous patient</button>
{% endblock %}

{% block beforecontent %}
    <div id="extra-top-links">
     <a href="activite-du-service">Activité du service</a>
     —
     <a href="validation-des-actes">Validation des actes</a>
     —
     <a href="rendez-vous-periodiques">Rendez-vous périodiques</a>
    </div>


    <div id="users">
    <div id="filtre">
     <input type="text"/>
    </div>
    <dl>
     {% for workers_type in workers_types %}
     <dt>{{ workers_type.type }}</dt>
     <dd><ul>
       {% for worker in workers_type.workers %}
       <li id="selector-worker-{{worker.id}}" class="person-item" data-worker-id="{{worker.id}}" data-target=".worker-{{worker.id}}.agenda">{{ worker.display_name }} <span title="cliquer pour déselectionner">(-)</span></li>
       {% endfor %}
     </ul></dd>
     {% endfor %}
   </dl>
 </div>
{% endblock %}

{% block agenda-content %}
   <table>
    <tbody>
    <tr>
     <td id="dispos">
      Disponibilités
      <table>
        {% for start_time, quaters in disponibility.items %}
          <tr class="hour-mark">
              <td rowspan="4">{{ start_time }}:00</td>
              {% for quater in quaters %}
                {% if forloop.counter != 1 %}
                <tr>
                {% endif %}
                {% for value in quater %}
                <td class="worker-{{ value.id }} agenda {{ value.dispo }}" style="display: none; "></td>
                {% endfor %}
              {% endfor %}
          </tr>
        {% endfor %}
      </table>
     </td>

     <td id="agendas">
       <div id="tabs">
       <ul>
        {% for worker_agenda in workers_agenda %}
        <li><a href="#tabs-worker-{{ worker_agenda.worker.id }}" data-id="{{ worker_agenda.worker.id }}" class="tab worker-{{ worker_agenda.worker.id }} agenda" style="display: none;">{{ worker_agenda.worker.display_name }}</a></li>
        {% endfor %}
       </ul>
       {% for worker_agenda in workers_agenda %}
       <div id="tabs-worker-{{ worker_agenda.worker.id }}" class="tabs agenda worker-{{ worker_agenda.worker.id }}" style="display: none;">
         <a class="print" href="#">Imprimer</a>
         <div>
           {% for appointment in worker_agenda.appointments %}
           <h3 class="{{ appointment.type }} appointment">
             <span class="hour">{{ appointment.begin_hour }}</span>
             {% if appointment.title %} — {{ appointment.title }}  {% endif %}
             {% if appointment.length %} — {{ appointment.length }}m {% endif %}
             {% if appointment.workers_initial %} —{{ appointment.workers_initial }} {% endif %}
             {% if appointment.act_type %} — {{ appointment.act_type }} {% endif %}
             {% if appointment.room %} — {{ appointment.room }} {% endif %}
             <span class="right">
                 {% if appointment.service and appointment.service != service %}
                 <span class="box {{ appointment.service }}" title="{{ appointment.service }}"></span>
                 {% endif %}
                 {% if appointment.convocation_sent %}
                 <img title="Une convocation a été envoyée" src="{{ STATIC_URL }}images/emblem-mail.png">
                 {% endif %}
                 {% if appointment.description %}
                 <img title="Un commentaire existe" src="{{ STATIC_URL }}images/emblem-documents.png">
                 {% endif %}
                 {% if appointment.event_id %}
                  {% if appointment.patient_record_id %}
                    <img title="Editer un rendez-vous" class="edit-appointment" src="{{ STATIC_URL }}images/accessories-text-editor.png" data-occurrence-id="{{ appointment.occurrence_id }}">
                  {% else %}
                    <img title="Editer un événement" class="edit-event" src="{{ STATIC_URL }}images/accessories-text-editor.png" data-occurrence-id="{{ appointment.occurrence_id }}">
                  {% endif %}
                 <img class="remove-appointment" title="Supprimer un rendez-vous" src="{{ STATIC_URL }}images/list-remove.png" data-occurrence-id="{{ appointment.occurrence_id }}" data-rdv="{{ appointment.title }}">
                 {% endif %}
            </span>
           </h3>

           <div>
               {% if appointment.type == 'free' %}
               <button class='newrdv' data-url="{% url 'nouveau-rdv' service=service date=date %}" data-hour="{{ appointment.begin_hour }}">Nouveau rendez-vous patient</button>
               <button class='newevent' data-url="{% url 'new-event' service=service date=date %}" data-hour="{{ appointment.begin_hour }}">Nouvel événement</button>
               {% endif %}
             {% if appointment.event_id %}
             <div class="tabs-worker-{{ worker_agenda.worker.id }} textedit">
                 <span></span>
                 <textarea>{{ appointment.description }}</textarea>
                 <button disabled="disabled" data-event-id="{{ appointment.event_id }}">✔</button>
             </div>
             {% endif %}
             {% if appointment.patient_record_id %}
             <a href="/{{ service }}/dossiers/{{ appointment.patient_record_id }}" target="_blank">Dossier patient</a> -
             <a href="#">Prochains rendez-vous</a> -
             <a href="#">Convoquer patient</a>
             {% endif %}
           </div>
           {% endfor %}
         </div>
       </div>
       {% endfor %}

       </div>

       </div>
     </td>
    </tr>
    </tbody>
   </table>
{% endblock %}

{% block dialogs %}
  <div id="rdv" style="display: none;">
 </div>
{% endblock %}
